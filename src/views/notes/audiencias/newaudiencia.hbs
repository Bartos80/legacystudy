<script>
  function ShowName(name) {
    const input = document.getElementById(name);
    const words = input.value.trim().split(" ");
    const formatted = words.map(w => w.charAt(0).toUpperCase() + w.slice(1).toLowerCase()).join(" ");
    input.value = formatted;
  }

  function ponerMayuscula(id) {
    const input = document.getElementById(id);
    input.value = input.value.toUpperCase();
  }

  function ponerminuscula(id) {
    const input = document.getElementById(id);
    input.value = input.value.toLowerCase();
  }
</script>

<div class="container my-5">
  <div class="col-md-8 mx-auto">
    <div class="card shadow-sm border-0">
      <div class="card-body p-4">
        <h3 class="text-center text-primary mb-4 fw-bold">
          <i class="bi bi-person-plus-fill me-2"></i> Nueva Audiencia
        </h3>

        <form action="/audiencias/newaudiencia" method="POST">

          <!-- Juzgado -->
          {{!-- <div class="mb-3">
            <label for="juzgado" class="form-label">Juzgado</label>
            <input type="text" id="juzgado" name="juzgado" class="form-control" placeholder="Ej: Juzgado Civil Nº 3"
              required>
          </div> --}}
          {{!-- <div>
            <label for="selectJuzgado">Seleccione un Juzgado:</label>
            <select id="selectJuzgado" name="selectJuzgado" required
              class="w-full px-4 py-2 border border-gray-300 rounded-lg shadow-sm focus:ring-indigo-500 focus:border-indigo-500 bg-white">
              <option value="Sin Juzgado" disabled>-- Sin Juzgado --</option>
              {{#each juzgado}}
              <option value="{{idjuzgado}}|{{numjuzgado}}|{{paisjuzgado}}|{{provinciajuzgado}}|{{localidadjuzgado}}">
                {{numjuzgado}}
              </option>
              {{/each}}
            </select>
          </div> --}}

          <div>
            <div class="flex items-center justify-between mb-2">
              <label for="selectJuzgado" class="block text-sm font-medium text-gray-700">Ingrese N° Juzgado:</label>

              {{!-- <button type="button" id="btnModoManual"
                class="text-xs bg-gray-200 hover:bg-gray-300 text-gray-700 py-1 px-2 rounded" style="color:green">
                O escriba manualmente
              </button>
            </div> --}}

            {{!-- <select id="selectJuzgado" name="selectJuzgado" required
              class="w-full px-4 py-2 border border-gray-300 rounded-lg shadow-sm focus:ring-indigo-500 focus:border-indigo-500 bg-white">
              <option value="" disabled selected>-- Seleccione un Juzgado --</option>
              {{#each juzgado}}
              <option value="{{idjuzgado}}|{{numjuzgado}}|{{paisjuzgado}}|{{provinciajuzgado}}|{{localidadjuzgado}}">
                {{numjuzgado}}
              </option>
              {{/each}}
            </select> --}}

            {{!-- <input type="text" id="inputJuzgadoManual" name="juzgadoManual" --}} <input type="text"
              inputmode="numeric" pattern="[0-9]*" oninput="this.value = this.value.replace(/[^0-9]/g, '');"
              id="numjuzgado" name="numjuzgado" placeholder="Numero de Juzgado..."
              class="hidden w-full mt-2 px-4 py-2 border border-blue-400 rounded-lg shadow-sm focus:ring-blue-500 focus:border-blue-500 bg-blue-50" required>
          </div>

          <p></p>

          <!-- Nº Expediente -->
          <div class="mb-3">
            <label for="numexpediente" class="form-label">Nº de Expediente</label>
            <input type="text" id="numexpediente" name="numexpediente" class="form-control" placeholder="Ej: 12345/2024"
              onkeyup="ponerMayuscula('numexpediente')" autofocus required>
          </div>

          <!-- estadoexpediente -->
          <div class="form-group mb-3">
            <label for="estadoexpediente" class="form-label">Estado del Expediente</label>
            <select name="estadoexpediente" id="estadoexpediente" class="form-select" required>
              <option></option>
              <option>A despacho</option>
              <option>En vista/giro</option>
              <option>En fiscalía</option>
              <option>Pre-paralizado</option>
              <option>Paralizado</option>
              <option>Archivado</option>
              <option>Otro...</option>
            </select>
          </div>

          <!-- Caratula -->
          <div class="mb-3">
            <label for="caratula" class="form-label">Carátula</label>
            <input type="text" id="caratula" name="caratula" class="form-control" placeholder="Carátula del Expediente"
              required>
          </div>

          <!-- Secretaría -->
          {{!-- <div class="mb-3">
            <label for="secretaria" class="form-label">Secretaría</label>
            <input type="text" id="secretaria" name="secretaria" class="form-control" placeholder="Ej: Secretaría B"
              required>
          </div> --}}

          <!-- Fecha Audiencia -->
          {{!-- <div class="mb-3">
            <label for="dateturno" class="form-label">Fecha Audiencia</label>
            <input type="date" id="dateturno" name="dateturno" class="form-control" required>
          </div> --}}
          <div class="mb-3">
            <label for="dateturno" class="form-label">Fecha Audiencia</label>
            <div class="input-group">
              <input type="date" id="dateturno" name="dateturno" class="form-control" required>

              <button class="btn btn-outline-primary" type="button" onclick="ponerFechaHoy()">
                <i class="bi bi-calendar-check"></i> Hoy
              </button>
            </div>
          </div>

          <!-- Hora Audiencia -->
          {{!-- --}}
          {{!-- <div class="mb-3">
            <label for="horaaudiencia" class="form-label">Hora Audiencia</label>
            <input type="time" id="horaaudiencia" name="horaaudiencia" class="form-control" min="08:00" max="18:00"
              step="900" required>
            <div class="form-text">Horario de atención: 08:00 AM a 06:00 PM (Intervalos de 15 min).</div>
          </div> --}}
          <div class="mb-3">
            <label for="horaaudiencia" class="form-label">Hora Audiencia</label>
            <div class="input-group">
              <input type="time" id="horaaudiencia" name="horaaudiencia" class="form-control" required>

              <button class="btn btn-outline-primary" type="button" title="Usar hora actual"
                onclick="ponerHoraActual()">
                <i class="bi bi-magic"></i> Ahora
              </button>
            </div>
          </div>

          <div class="form-group">
            Observaciones:
            <input type="text" style="font-weight: bold; color:green" minlength="0" maxlength="50" name="observaciones"
              class="form-control" placeholder="Observaciones"></input>
          </div>
          <!-- Foto expediente (deshabilitado) -->
          {{!-- <div class="mb-3">
            <label class="form-label">Foto del Expediente</label>
            <input type="text" name="fotoexpediente" class="form-control" placeholder="Foto de expediente" disabled>
          </div> --}}
          <p></p>
          <!-- Botón guardar -->
          <div class="d-grid mb-3">
            <button type="submit" class="btn btn-primary">Guardar Audiencia</button>
          </div>
          <!-- Volver -->
          <div class="text-center">
            <a href="/Audiencia/listado" class="text-decoration-none text-muted">
              <i class="fas fa-arrow-left me-1"></i> Volver al listado
            </a>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

<script>
  const btnModoManual = document.getElementById('btnModoManual');
  const selectJuzgado = document.getElementById('selectJuzgado');
  const inputJuzgadoManual = document.getElementById('inputJuzgadoManual');

  btnModoManual.addEventListener('click', () => {
    // 1. Verificamos si estamos en modo manual o no
    const esManual = inputJuzgadoManual.classList.contains('hidden');

    if (esManual) {
      // ACTIVAR MODO MANUAL
      inputJuzgadoManual.classList.remove('hidden'); // Muestra el input
      inputJuzgadoManual.disabled = false;           // Permite escribir
      inputJuzgadoManual.required = true;            // Lo hace obligatorio

      selectJuzgado.classList.add('hidden');         // Oculta el select
      selectJuzgado.disabled = true;                 // Deshabilita el select (no se envía en el form)

      btnModoManual.innerText = "Volver a la lista";
    } else {
      // VOLVER A MODO SELECT
      inputJuzgadoManual.classList.add('hidden');
      inputJuzgadoManual.disabled = true;
      inputJuzgadoManual.required = false;

      selectJuzgado.classList.remove('hidden');
      selectJuzgado.disabled = false;

      btnModoManual.innerText = "O escribir manualmente";
    }
  });
</script>

<script>
  function ponerFechaHoy() {
    const inputFecha = document.getElementById('dateturno');
    const hoy = new Date();
    
    // Obtener año, mes y día
    const yyyy = hoy.getFullYear();
    const mm = String(hoy.getMonth() + 1).padStart(2, '0'); // Los meses van de 0 a 11
    const dd = String(hoy.getDate()).padStart(2, '0');
    
    // Formato requerido por el input type="date": YYYY-MM-DD
    const fechaFormateada = `${yyyy}-${mm}-${dd}`;
    
    inputFecha.value = fechaFormateada;
  }

  // Opcional: Si quieres que la fecha de hoy aparezca cargada por defecto al abrir la página
  // window.onload = ponerFechaHoy;
</script>

<script>
  function ponerHoraActual() {
    const inputHora = document.getElementById('horaaudiencia');
    const ahora = new Date();

    // Formatear la hora a HH:MM (formato de 24h que requiere el input)
    const horas = String(ahora.getHours()).padStart(2, '0');
    const minutos = String(ahora.getMinutes()).padStart(2, '0');

    inputHora.value = `${horas}:${minutos}`;
  }  
</script>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">

<script>
  const selectJuzgado = document.getElementById('selectJuzgado');
  const idjuzgado = document.getElementById('idjuzgado');
  const numjuzgado = document.getElementById('numjuzgado');
  const paisjuzgado = document.getElementById('paisjuzgado');
  const provinciajuzgado = document.getElementById('provinciajuzgado');
  const localidadjuzgado = document.getElementById('localidadjuzgado');

  selectJuzgado.addEventListener('change', function () {
    const valorCompleto = this.value;
    if (valorCompleto === "") {
      idjuzgado.value = "";
      numjuzgado.value = "";
      paisjuzgado.value = "";
      provinciajuzgado.value = "";
      localidadjuzgado.value = "";
      return;
    }
    const partes = valorCompleto.split('|');
    idjuzgado.value = partes[0] || '';
    numjuzgado.value = partes[1] || '';
    paisjuzgado.value = partes[2] || '';
    provinciajuzgado.value = partes[3] || '';
    localidadjuzgado.value = partes[4] || '';
  });
</script>